<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Certificato di Pagamento</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body class="container my-4">
    <div id="certificato" class="p-4 border bg-white">
      <div class="d-flex justify-content-between align-items-center mb-5 border-bottom pb-3">
        <h2 class="text-uppercase fw-bold">Certificato di Pagamento (SAL)</h2>
        <div>
             <img src="" alt="" style="max-height: 50px; display:none;" id="companyLogo"> <!-- Placeholder for future logo -->
             <button id="download" class="btn btn-success d-print-none">Scarica PDF</button>
        </div>
      </div>

      <!-- Top Header: Committente / Impresa / Lavori -->
      <div class="row g-0 mb-4 border border-secondary">
          <!-- Left: Committente -->
          <div class="col-md-12 border-bottom border-secondary bg-light">
              <div class="d-flex border-bottom border-secondary">
                  <div class="p-2 fw-bold text-uppercase border-end border-secondary bg-light" style="width: 200px;">IL COMMITTENTE</div>
                  <div class="p-2 flex-grow-1 fw-bold" id="committenteRagione"></div>
                  <div class="p-2 border-start border-secondary" id="committenteIndirizzo"></div>
              </div>
          </div>
          
           <!-- Impresa -->
           <div class="col-md-12 border-bottom border-secondary bg-light">
              <div class="d-flex">
                  <div class="p-2 fw-bold text-uppercase border-end border-secondary bg-light" style="width: 200px;">L'IMPRESA</div>
                  <div class="p-2 flex-grow-1 fw-bold" id="impresaRagione"></div>
                  <div class="p-2 border-start border-secondary" id="impresaIndirizzo"></div>
              </div>
          </div>

          <!-- Lavori Di -->
           <div class="col-md-12 bg-white">
              <div class="d-flex">
                  <div class="p-2 fw-bold text-uppercase border-end border-secondary bg-light" style="width: 200px;">LAVORI DI</div>
                  <div class="p-2 flex-grow-1" id="progettoDescrizione"></div>
              </div>
              <div class="d-flex border-top border-secondary">
                 <div class="p-2 fw-bold text-uppercase border-end border-secondary bg-white" style="width: 200px;"></div>
                 <div class="p-2 text-muted small">Cantiere sito in: <span id="progettoIndirizzo"></span></div>
              </div>
          </div>
      </div>

      <hr class="my-4" />
      
      <div class="container-fluid px-0">
        <div class="row gx-4">
          <!-- Left Column: History & Info -->
          <div class="col-md-4">
            <div class="mb-4">
                <h6 class="fw-bold text-uppercase border-bottom pb-1 mb-2">Certificati Precedenti</h6>
                <table class="table table-striped table-sm" id="precedenti-table">
                <thead class="table-dark">
                    <tr>
                    <th class="text-center">N.</th>
                    <th class="text-center">Data</th>
                    <th class="text-end">Importo</th>
                    </tr>
                </thead>
                <tbody></tbody>
                </table>
            </div>

            <div class="mb-4">
              <h6 class="fw-bold text-uppercase border-bottom pb-1 mb-2">Assicurazioni Infortuni</h6>
              <table class="table table-bordered table-sm font-monospace small" id="assicurazioni-table">
                <thead class="table-light">
                  <tr>
                    <th>Ente / Sede</th>
                    <th>Numero Posizione</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="mb-3">
                <ul class="list-group list-group-flush small">
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        Inizio Lavori
                        <span class="fw-bold" id="dataInizio"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        Termine Ultimo
                        <span class="fw-bold" id="dataFine"></span>
                    </li>
                </ul>
            </div>
          </div>

          <!-- Right Column: Main Calculation -->
          <div class="col-md-8">
            <!-- Main Title Box -->
            <div class="border border-secondary mb-3">
                <div class="bg-light p-2 text-center border-bottom border-secondary">
                    <!-- <h3 class="fw-bold mb-0">CERTIFICATO DI PAGAMENTO N. <span id="certificato-numero" class="text-danger">-</span></h3> -->
                    <h3 class="fw-bold mb-0">CERTIFICATO DI PAGAMENTO N. <span id="numero-certificato-box" class="text-danger">-</span></h3>
                </div>
                <div class="d-flex">
                    <!-- <div class="p-2 border-end border-secondary bg-info bg-opacity-10 fw-bold" style="width: 50%;">Stato di Avanzamento Lavori N. <span id="numero-sal-box">-</span></div> -->
                    <div class="p-2 border-end border-secondary bg-info bg-opacity-10 fw-bold" style="width: 50%;">Stato di Avanzamento Lavori N. <span id="numero-certificato-box">-</span></div>
                    <div class="p-2 border-end border-secondary fw-bold text-end" style="width: 25%;">A tutto il</div>
                    <div class="p-2 fw-bold text-center text-success" style="width: 25%;" id="data-certificato"></div>
                </div>
            </div>
            
            <table class="table table-bordered table-hover shadow-sm">
                <thead class="table-light">
                     <tr>
                         <th colspan="2">Descrizione</th>
                         <th class="text-center" style="width: 100px;">Rif.</th>
                         <th class="text-end" style="width: 140px;">Importo</th>
                     </tr>
                </thead>
              <tbody>
                <tr>
                  <td><strong>A</strong></td>
                  <td><strong>Importo Lavori a Contratto</strong></td>
                  <td class="text-center text-muted">-</td>
                  <td class="text-end fw-bold"><span id="totaleA">0,00€</span></td>
                </tr>
                <tr>
                  <td>B</td>
                  <td>Oneri della sicurezza</td>
                  <td class="text-center text-muted">-</td>
                  <td class="text-end"><span id="totaleB">0,00€</span></td>
                </tr>
                <tr>
                  <td>C</td>
                  <td>Ordine di variante n1</td>
                  <td class="text-center text-muted">06.06.24</td>
                  <td class="text-end"><span id="totaleC">0,00€</span></td>
                </tr>
                <tr>
                  <td>D</td>
                  <td><strong>Totale Corrispettivo di Appalto</strong> (A+B+C)</td>
                  <td class="text-center text-muted">-</td>
                  <td class="text-end fw-bold"><span id="totaleD">0,00€</span></td>
                </tr>
                
                <tr class="table-secondary"><td colspan="4" class="text-center py-1"><small class="fw-bold text-uppercase">Stato di Avanzamento e Contabilità</small></td></tr>
                
                <tr>
                  <td>E</td>
                  <td>LAVORI STRUTTURALI E OPERE CIVILI</td>
                  <td class="text-center">a corpo</td>
                  <td class="text-end"><span id="totaleE">0,00€</span></td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>IMPIANTO ELETTRICO</td>
                  <td class="text-center">a corpo</td>
                  <td class="text-end"><span id="totaleF">0,00€</span></td>
                </tr>
                <tr>
                  <td>G</td>
                  <td>IMPIANTO MECCANICO</td>
                  <td class="text-center">a corpo</td>
                  <td class="text-end"><span id="totaleG">0,00€</span></td>
                </tr>
                <tr>
                  <td>H</td>
                  <td>Ordini di Variante (OdV1)</td>
                  <td class="text-center">-</td>
                  <td class="text-end"><span id="totaleH">0,00€</span></td>
                </tr>
                <tr>
                  <td>I</td>
                  <td>ONERI DELLA SICUREZZA</td>
                  <td class="text-center">-</td>
                  <td class="text-end"><span id="totaleI">0,00€</span></td>
                </tr>
                <tr class="table-info fw-bold">
                  <td>J</td>
                  <td colspan="2">TOTALE LAVORI ESEGUITI (E+F+G+H+I)</td>
                  <td class="text-end"><span id="totaleJ">0,00€</span></td>
                </tr>
                
                <tr class="table-secondary"><td colspan="4" class="text-center py-1"><small class="fw-bold text-uppercase">Ritenute e Detrazioni</small></td></tr>

                <tr>
                  <td>K</td>
                  <td>Recupero anticipo (5% art.8.1)</td>
                  <td class="text-center text-danger">(-)</td>
                  <td class="text-end text-danger"><span id="totaleK1">0,00€</span></td>
                </tr>
                <tr>
                  <td>L</td>
                  <td>Ritenuta a garanzia (10% art.8.8)</td>
                  <td class="text-center text-danger">(-)</td>
                  <td class="text-end text-danger"><span id="totaleL1">0,00€</span></td>
                </tr>
                 <tr>
                  <td>M</td>
                  <td>Ulteriori Ritenute (0,5% art.8.8)</td>
                  <td class="text-center text-danger">(-)</td>
                  <td class="text-end text-danger"><span id="totaleL2">0,00€</span></td>
                </tr>
                <tr class="fw-bold text-secondary">
                  <td>N</td>
                  <td colspan="2">Totale Trattenute</td>
                  <td class="text-end"><span id="totaleM">0,00€</span></td>
                </tr>
                
                <tr class="table-primary fw-bold" style="font-size: 1.1em;">
                  <td>O</td>
                  <td colspan="2">AMMONTARE NETTO S.A.L. (J - N)</td>
                  <td class="text-end"><span id="totaleN">0,00€</span></td>
                </tr>
                <tr>
                  <td>P</td>
                  <td colspan="2">Dedotti acconti precedenti</td>
                  <td class="text-end text-muted"><span id="totaleO">0,00€</span></td>
                </tr>
                <tr>
                  <td>Q</td>
                  <td colspan="2">Arrotondamenti</td>
                  <td class="text-end"><span id="totaleP">0,00€</span></td>
                </tr>
                <tr class="table-success fw-bold border-top border-3 border-success" style="font-size: 1.25em;">
                  <td colspan="3" class="text-uppercase">Totale netto da pagare a saldo</td>
                  <td class="text-end">
                    <span id="totaleRimanente">0,00€</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Firmas -->
      <div class="row mt-5 pt-2" id="firmas-section">
        <div class="col-12">
            <div class="row gx-0 text-center border border-secondary bg-light fw-bold text-uppercase small">
                <div class="col-4 border-end border-secondary py-1">Il R.L. e CSE</div>
                <div class="col-4 border-end border-secondary py-1">Il Committente</div>
                <div class="col-4 py-1">L'Impresa</div>
            </div>
            <div class="row gx-0 border-start border-end border-bottom border-secondary" style="min-height: 80px;">
                <div class="col-4 border-end border-secondary p-2 d-flex align-items-end justify-content-center">
                    <small id="committenteRL_Firma"></small>
                </div>
                 <div class="col-4 border-end border-secondary p-2 d-flex align-items-end justify-content-center">
                    <!-- Placeholder for Committente Signature or DL -->
                    <small class="text-muted text-uppercase" id="committenteDL_Firma"></small> 
                </div>
                <div class="col-4 p-2 d-flex align-items-end justify-content-center">
                    <small id="impresaRagione_Firma"></small>
                </div>
            </div>
             <div class="row gx-0 text-center border-start border-end border-bottom border-secondary bg-light fw-bold text-uppercase small">
                <!-- Additional row if needed for titles, otherwise keep single row -->
                <div class="col-4 border-end border-secondary py-1">(firma)</div>
                <div class="col-4 border-end border-secondary py-1">(firma)</div>
                <div class="col-4 py-1">(firma)</div>
            </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="js_empresa/certificado.js"></script>
  </body>
</html>
