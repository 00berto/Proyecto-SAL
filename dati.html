<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Dati Impresa - Certificato SAL</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container py-4">
    <h3 class="mb-4">Dati Certificato di Pagamento</h3>

    <form>
      <!-- Datos del Committente -->
      <fieldset class="mb-4">
        <legend>IL COMMITTENTE</legend>
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">Ragione sociale</label>
            <input type="text" id="committenteRagione" class="form-control" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Indirizzo completo</label>
            <input type="text" id="committenteIndirizzo" class="form-control" />
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Referente</label>
          <input type="text" id="committenteReferente" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Il R.L. e CSE</label>
          <input type="text" id="committenteRL" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Direttore dei lavori</label>
          <input type="text" id="committenteDL" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Project Manager</label>
          <input type="text" id="committentePM" class="form-control" />
        </div>
      </fieldset>

      <!-- Datos de la Impresa -->
      <fieldset class="mb-4">
        <legend>L'IMPRESA</legend>
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">Ragione sociale</label>
            <input type="text" id="impresaRagione" class="form-control" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Indirizzo completo</label>
            <input type="text" id="impresaIndirizzo" class="form-control" />
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Referente</label>
          <input type="text" id="impresaReferente" class="form-control" />
        </div>

        <div class="mb-3">
          <label class="form-label">Direttore dei lavori</label>
          <input type="text" id="impresaDL" class="form-control" />
        </div>
      </fieldset>

      <!-- Proyecto -->
      <fieldset class="mb-4">
        <legend>INFO DEL PROGETTO</legend>
        <div class="mb-3">
          <label class="form-label">Descrizione del Progetto</label>
          <textarea id="progettoDescrizione" class="form-control"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Indirizzo del Progetto</label>
          <input type="text" id="progettoIndirizzo" class="form-control" />
        </div>
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">Data inicio</label>
            <input type="date" id="dataInizio" class="form-control" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Data fine prevista</label>
            <input type="date" id="dataFine" class="form-control" />
          </div>
        </div>
      </fieldset>

      <!-- Infortuni -->
      <div class="container mt-5">
        <form id="presse-form">
          <fieldset class="mb-4">
            <legend>Assicurazioni Infortuni</legend>
            <p class="text-muted">Assicurazione Infortuni</p>

            <div id="presse-container">
              <div class="row g-3 mb-3">
                <div class="col-md-6">
                  <label class="form-label visually-hidden"
                    >Indirizzo/Sede</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Indirizzo/Sede"
                    name="indirizzo[]"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label visually-hidden">Numero</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Numero"
                    name="numero[]"
                    required
                  />
                </div>
              </div>
            </div>

            <button type="button" class="btn btn-light" id="add-field-btn">
              Aggiungi Assicurazione
            </button>
          </fieldset>
        </form>
      </div>
      <!-- Botón -->
      <button type="button" class="btn btn-primary" onclick="salvaDati()">
        Salvare / Continuare
      </button>
    </form>
    <script>
      //btn añadir assicuracione
      document
        .getElementById("add-field-btn")
        .addEventListener("click", function () {
          const container = document.getElementById("presse-container");
          const newField = document.createElement("div");
          newField.className = "row g-3 mb-3";
          newField.innerHTML = `
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="Indirizzo/Sede" name="indirizzo[]" required />
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="Numero" name="numero[]" required />
        </div>
      `;
          container.appendChild(newField);
        });
    </script>
    <script>
      function salvaDati() {
        const dati = {
          //commitente
          committenteRagione:
            document.getElementById("committenteRagione").value,
          committenteIndirizzo: document.getElementById("committenteIndirizzo")
            .value,
          committenteReferente: document.getElementById("committenteReferente")
            .value,
          committenteRL: document.getElementById("committenteRL").value,
          committenteDL: document.getElementById("committenteDL").value,
          committentePM: document.getElementById("committentePM").value,
          //emprsa
          impresaRagione: document.getElementById("impresaRagione").value,
          impresaIndirizzo: document.getElementById("impresaIndirizzo").value,
          committenteReferente:
            document.getElementById("impresaReferente").value,

          impresaDL: document.getElementById("impresaDL").value,
          //progetto
          progettoDescrizione: document.getElementById("progettoDescrizione")
            .value,
          progettoIndirizzo: document.getElementById("progettoIndirizzo").value,
          dataInizio: document.getElementById("dataInizio").value,
          dataFine: document.getElementById("dataFine").value,
        };

        //infortuni
        const indirizzi = document.querySelectorAll(
          'input[name="indirizzo[]"]'
        );
        const numeros = document.querySelectorAll('input[name="numero[]"]');
        const assicurazioni = [];

        for (let i = 0; i < indirizzi.length; i++) {
          assicurazioni.push({
            indirizzo: indirizzi[i].value,
            numero: numeros[i].value,
          });
        }
        dati.assicurazioni = assicurazioni;

        localStorage.setItem("certificatoDati", JSON.stringify(dati));
        window.location.href = "certificado.html";
      }
    </script>
  </body>
</html>
